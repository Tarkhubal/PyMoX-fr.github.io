name: Deploy Docs (CRON Ã  â‰ƒ 3h00)

on:
  schedule:
    - cron: "0 1 * * *" # Tous les jours Ã  3h (GMT) du matin
    # - cron: '0 * * * *' # Toutes les heures
    # - cron: '*/15 * * * *' # Toutes les 15 minutes
    # - cron: "*/5 * * * *" # Toutes les 5 minutes

jobs:
  daily-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: ðŸ› ï¸ Installer les dÃ©pendances via script Python
        run: python resources/auto/subs/install_deps.py

      # RÃ©cupÃ©ration des rapports depuis gh-pages/reports
      - name: ðŸ§² RÃ©cupÃ©rer les rapports depuis gh-pages/reports
        run: python resources/auto/subs/get_reports.py --files CHANGELOG.md hebdo.md versions.json
        # Cette Ã©tape assure que nous utilisons toujours les rapports les plus rÃ©cents

      - name: ðŸ“‹ GÃ©nÃ¨re deploy_info.md
        run: python resources/auto/gen_deploy_info.py --mode cron
        # Utilise le mode CRON pour indiquer que c'est un dÃ©ploiement automatique

      - name: ðŸŒ PrÃ©pare le fichier CNAME
        run: echo "pymox.fr" > docs/CNAME

      - name: ðŸš€ DÃ©ploie vers gh-pages
        run: mkdocs gh-deploy --force

      - name: ðŸ’¾ Sauvegarde les rapports dans ðŸŒ¿ gh-pages/reports
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          FILES_TO_SAVE: "CHANGELOG.md hebdo.md versions.json deploy_info.md"
        run: |
          python resources/auto/subs/push_reports.py \
            --files ${FILES_TO_SAVE} \
            --keep-originals \
            --ghref "cron-daily"

          # CrÃ©er un tag automatiquement:
          #   git tag -a "cron-deploy-$(date +%Y%m%d%H%M)" -m "DÃ©ploiement CRON automatique"

          # ðŸ” Ã‰criture dans le fichier logs selon le type de commit
          # if [[ "$MSG" == â±ï¸* ]]; then
          #   echo "Dernier commit (AUTO pour rebuild): $DATE" >> "$LOGS_FILE"
          # else
          #   echo "Commit ($MSG < $AUTOR - Manual Push): $DATE" >> "$LOGS_FILE"
          # fi

          # ðŸ¤– Si c'est un dÃ©clenchement CRON
          # if [[ "${{ github.event_name }}" == "schedule" ]]; then
