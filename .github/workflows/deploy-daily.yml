name: Deploy Docs (CRON Ã  â‰ƒ 3h00)

on:
  schedule:
    - cron: "0 1 * * *" # Tous les jours Ã  3h (GMT) du matin
    # - cron: '0 * * * *' # Toutes les heures
    # - cron: '*/15 * * * *' # Toutes les 15 minutes
    # - cron: "*/5 * * * *" # Toutes les 5 minutes
jobs:
  daily-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v3

      - name: ğŸ› ï¸ Installer MkDocs + plugins
        run: |
          pip install --upgrade pip
          pip install mkdocs mkdocs-material pyodide-mkdocs-theme mkdocs-awesome-pages-plugin mkdocs-open-in-new-tab
      - name: ğŸŒ PrÃ©pare le fichier CNAME
        run: echo "pymox.fr" > docs/CNAME
      - name: â±ï¸ Build CRON silencieux
        env:
          TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SHA: ${{ github.sha }}
        run: |
          DEPLOY_INFO_DIR="docs/outils/logs"
          DEPLOY_INFO_FILE="deploy_info.md"
          DEPLOY_INFO_PATH="$DEPLOY_INFO_DIR/$DEPLOY_INFO_FILE"

          mkdir -p "$(dirname "$DEPLOY_INFO_PATH")"
          # mkdir -p "$DEPLOY_INFO_PATH"

          DATE_HUMAN="$(TZ='Europe/Paris' date '+%d/%m/%Y')"
          TIME_HUMAN="$(TZ='Europe/Paris' date '+%H:%M:%S')"
          DATE_ISO="$(date -u '+%Y-%m-%dT%H:%M:%SZ')"
          DATE_UNIX="$(date +%s)"
          MSG="â±ï¸ DÃ©ploiement automatique CRON"
          AUTOR="PyMoX"

          echo "# â±ï¸ Dernier dÃ©ploiement" > "$DEPLOY_INFO_PATH"
          echo "" >> "$DEPLOY_INFO_PATH"

          echo "## â†’ Automatique" >> "$DEPLOY_INFO_PATH"
          echo "" >> "$DEPLOY_INFO_PATH"

          echo "| ğŸ“… Date        | ğŸ•°ï¸ Heure (Paris)       | ğŸŒ ISO 8601 UTC         | ğŸ”¢ Timestamp UNIX |" >> "$DEPLOY_INFO_PATH"
          echo "|----------------|------------------------|------------------------|--------------------|" >> "$DEPLOY_INFO_PATH"
          echo "| **$DATE_HUMAN**  | **$TIME_HUMAN**        | \`$DATE_ISO\`   | \`$DATE_UNIX\`       |" >> "$DEPLOY_INFO_PATH"
          echo "" >> "$DEPLOY_INFO_PATH"

          
          echo "### ğŸ“‹ Informations de dÃ©ploiement" >> "$DEPLOY_INFO_PATH"
          echo "" >> "$DEPLOY_INFO_PATH"
          echo "ğŸ“ Message Git : **${MSG}**<br>" >> "$DEPLOY_INFO_PATH"
          echo "ğŸ‘¤ Auteur : ${AUTOR}<br>" >> "$DEPLOY_INFO_PATH"
          echo "ğŸ” SHA Commit : \`${SHA}\`<br>" >> "$DEPLOY_INFO_PATH"
          echo "ğŸš€ **DÃ©clencheur** : GitHub Actions" >> "$DEPLOY_INFO_PATH"
          echo "<br><br>" >> "$DEPLOY_INFO_PATH"

          echo "> âœ… Ce dÃ©ploiement a Ã©tÃ© enclenchÃ© **automatiquement** comme chaque nuit vers 4h (G.M.T.)." >> "$DEPLOY_INFO_PATH"

          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          git add "$DEPLOY_INFO_PATH"
          git commit -m "â±ï¸ DÃ©ploiement quotidien CRON ($DATE_HUMAN - $TIME_HUMAN)"
          git remote set-url origin https://x-access-token:${TOKEN}@github.com/${{ github.repository }}
          git push

      - name: ğŸŒ Ajoute le fichier CNAME + dÃ©ploiement
        run: |
          echo "pymox.fr" > docs/CNAME
          mkdocs gh-deploy --force

          # CrÃ©er un tag automatiquement:
          #   git tag -a "cron-deploy-$(date +%Y%m%d%H%M)" -m "DÃ©ploiement CRON automatique"

          # ğŸ” Ã‰criture dans le fichier logs selon le type de commit
          # if [[ "$MSG" == â±ï¸* ]]; then
          #   echo "Dernier commit (AUTO pour rebuild): $DATE" >> "$LOGS_FILE"
          # else
          #   echo "Commit ($MSG < $AUTOR - Manual Push): $DATE" >> "$LOGS_FILE"
          # fi

          # ğŸ¤– Si c'est un dÃ©clenchement CRON
          # if [[ "${{ github.event_name }}" == "schedule" ]]; then
